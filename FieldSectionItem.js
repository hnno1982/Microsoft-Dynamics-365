/** @license Copyright (c) Microsoft Corporation. All rights reserved. */
var MscrmGeneric;(function(MscrmGeneric){var Containers;(function(Containers){"use strict";var FieldSectionItemModeManager=function(){function FieldSectionItemModeManager(ins){this.instance=ins}FieldSectionItemModeManager.prototype.getMode=function(){return this.currentMode};FieldSectionItemModeManager.prototype.setMode=function(newMode,params){var oldMode=this.currentMode;if(oldMode==null)oldMode=MscrmCommon.DisplayMode.UNKNOWN;if(oldMode!=newMode){switch(newMode){case MscrmCommon.DisplayMode.EDITHINT:case MscrmCommon.DisplayMode.EDIT:if(!params||!params["tabfocus"]&&!params["initial"])if(newMode==MscrmCommon.DisplayMode.EDITHINT)this.instance.context.utils.setInteractionMode(MscrmCommon.DisplayMode.EDITHINT);else this.instance.context.utils.setInteractionMode(MscrmCommon.DisplayMode.EDIT);switch(oldMode){case MscrmCommon.DisplayMode.READ:if(this.instance.isDefaultToggle()){this.instance.fieldClicked=true;this.instance.context.utils.notifyOutputChanged()}else this.instance.context.mode.focus();break;case MscrmCommon.DisplayMode.EDITHINT:this.instance.fromEditHintToEditForceRender=true;this.instance.context.utils.requestRender()}break;case MscrmCommon.DisplayMode.READ:!(params&&params["initial"])&&this.instance.context.utils.setInteractionMode(MscrmCommon.DisplayMode.EDITHINT);switch(oldMode){case MscrmCommon.DisplayMode.EDIT:this.instance.context.mode.blur();break}break}this.currentMode=newMode}};return FieldSectionItemModeManager}(),FieldSectionItem=function(){function FieldSectionItem(){this.fieldClicked=false;this.fromEditHintToEditForceRender=false;this.modeManager=new FieldSectionItemModeManager(this);this.topDivRef="topDivRef"}FieldSectionItem.prototype.init=function(state){};FieldSectionItem.prototype.getFirstChild=function(){for(var key in this.context.children){var forceRender=this.fromEditHintToEditForceRender;if(forceRender)this.fromEditHintToEditForceRender=false;return this.context.children[key].getVirtualRepresentation({forcerender:forceRender,controlstates:{hasFocus:this.context.mode.hasFocus},childeventlisteners:this.generateChildListeners()})}};FieldSectionItem.prototype.isDefaultToggle=function(){return this.context.parameters.value.type.toLowerCase()=="twooptions"&&(!this.context.children||this.getFirstChild().getType().indexOf("MscrmGeneric.FieldControls.TwoOptions")!=-1)};FieldSectionItem.prototype.onBodyClick=function(){this.modeManager.setMode(MscrmCommon.DisplayMode.READ,null)};FieldSectionItem.prototype.onElementClick=function(event){event.stopPropagation();var updateChildToEdit=function(){this.modeManager.setMode(MscrmCommon.DisplayMode.EDIT,null)}.bind(this);window.setTimeout(updateChildToEdit,0)};FieldSectionItem.prototype.onKeyDownHandler=function(event){if(event.type=="keydown")switch(event.keyCode){case 9:this.context.utils.getElementByRef(this.topDivRef)!=null&&this.context.utils.getElementByRef(this.topDivRef).focus();this.context.utils.setLastTabPressedTime(Date.now());this.context.mode.blur();break;case 13:this.modeManager.getMode()==MscrmCommon.DisplayMode.EDITHINT&&this.modeManager.setMode(MscrmCommon.DisplayMode.EDIT,null);break;case 27:this.modeManager.getMode()!=MscrmCommon.DisplayMode.READ&&this.modeManager.setMode(MscrmCommon.DisplayMode.READ,null);break}};FieldSectionItem.prototype.onFocusHandler=function(event){if(this.context.utils.isTabPressed())if(this.context.utils.getInteractionMode()==MscrmCommon.DisplayMode.EDITHINT)this.modeManager.setMode(MscrmCommon.DisplayMode.EDITHINT,{tabfocus:true});else this.modeManager.setMode(MscrmCommon.DisplayMode.EDIT,{tabfocus:true})};FieldSectionItem.prototype.render=function(){var children=[],fieldName=this.context.parameters.value.attributes.name,fieldWriteable=this.context.parameters.value.security.editable,isFieldLocked=this.context.mode.isControlDisabled||!fieldWriteable,isSecured=this.context.parameters.value.security.secured,isRequired=this.context.parameters.value.attributes.requiredLevel==Mscrm.RequiredLevel.SystemRequired||this.context.parameters.value.attributes.requiredLevel==Mscrm.RequiredLevel.ApplicationRequired,isRecommended=this.context.parameters.value.attributes.requiredLevel==Mscrm.RequiredLevel.Recommended,isPhone=this.context.client.formFactor==Mscrm.FormFactor.Phone,startMode=this.context.mode.hasFocus?this.context.utils.getInteractionMode()==MscrmCommon.DisplayMode.EDIT?MscrmCommon.DisplayMode.EDIT:MscrmCommon.DisplayMode.EDITHINT:MscrmCommon.DisplayMode.READ;this.modeManager.setMode(startMode,{initial:true});var lockIcon=this.context.factory.createElement("ICON",{symbolName:"lock"});isFieldLocked&&!isPhone&&children.push(lockIcon);if(this.context.mode.label){var labelText=this.context.mode.label,labelSpan=this.context.factory.createElement("SPAN",{},labelText),icons=[];(isRecommended||isRequired)&&icons.push(this.context.factory.createElement("ICON",{symbolName:"requiredIcon"}));isFieldLocked&&isPhone&&icons.push(lockIcon);isSecured&&icons.push(this.context.factory.createElement("ICON",{symbolName:"securedIcon"}));var iconContainer=this.context.factory.createElement("SPAN",{className:"fieldLabelInlineIcons"},icons),labelContainer=this.context.factory.createElement("VIEW",{onShortPress:this.onElementClick.bind(this),className:"control_label Section_label_common"},this.context.factory.createElement("LABEL",null,[this.context.factory.createElement("SPAN",null,labelText),iconContainer]));children.push(labelContainer)}var control;if(this.context.children)control=this.getFirstChild();else control=this.createDefaultControl();var containerClass="control_value Section_value_common Section_value_alignment";if(this.context.parameters.value.type=="SingleLine.TextArea")containerClass+=" multiline_label";if(this.context.mode.hasFocus&&this.context.parameters.value.type.toLowerCase()=="optionset")containerClass+=" comboBoxContainer";if(this.context.mode.hasFocus&&!this.isDefaultToggle())containerClass+=" editControlContainer";var controlContainer=this.context.factory.createElement("VIEW",{className:containerClass,onShortPress:this.onElementClick.bind(this)},control);children.push(controlContainer);if(this.context.parameters.value.error){var errorMessage=this.context.factory.createElement("ERROR",{errorMessage:this.context.parameters.value.errorMessage},null);children.push(errorMessage)}var style={};if(!this.context.mode.isVisible)style["display"]="none";var sectionClass=this.createClassName(),onBody=this.isDefaultToggle()?null:this.onBodyClick.bind(this),tabIndex="0",refId=this.topDivRef,onFocusHandler=this.onFocusHandler.bind(this),onKeyDownHandler=this.onKeyDownHandler.bind(this);return this.context.factory.createElement("BODYLISTENVIEW",{style:style,className:sectionClass,tabIndex:tabIndex,ref:refId,onFocus:onFocusHandler,onKeyDown:onKeyDownHandler,onBodyClick:onBody},children)};FieldSectionItem.prototype.createClassName=function(){var className="section_control";if(!this.context.mode.label)className+=" noLabel";if(this.context.parameters.value.error)className+=" hasError";if(this.context.parameters.value.attributes.requiredLevel==Mscrm.RequiredLevel.ApplicationRequired||this.context.parameters.value.attributes.requiredLevel==Mscrm.RequiredLevel.SystemRequired)className+=" requiredField";if(this.context.parameters.value.attributes.requiredLevel==Mscrm.RequiredLevel.Recommended)className+=" recommendedField";if(this.context.parameters.value.security.secured)className+=" securedField";if(this.context.mode.hasFocus)className+=" editRow";if(this.context.parameters.value.type.toLowerCase()=="optionset")className+=" comboBoxRow";if(this.context.mode.isControlDisabled)className+=" locked";return className};FieldSectionItem.prototype.generateChildListeners=function(){var readToEditFocus={eventname:"FROM_READ_TO_EDIT",eventhandler:this.context.mode.focus.bind(this)};return [readToEditFocus]};FieldSectionItem.prototype.createDefaultControl=function(){var id="fieldControl",valueParam={Usage:0,Type:this.context.parameters.value.type,Value:this.context.parameters.value.attributes.name,Static:false,Primary:true},labelBehaviorParam={Type:"TwoOptions",Static:true,Value:true},properties={controlstates:{hasFocus:this.context.mode.hasFocus,isControlDisabled:this.context.mode.isControlDisabled},parameters:{value:valueParam,ShowLabelWhenUnfocused:labelBehaviorParam},childeventlisteners:this.generateChildListeners()},controlType;switch(this.context.parameters.value.type){case "OptionSet":controlType="MscrmGeneric.FieldControls.OptionSet";break;default:return this.context.factory.createElement("SPAN",null,"NO SUPPORT YET")}return this.context.factory.createComponent(controlType,id,properties)};FieldSectionItem.prototype.getOutputs=function(){var value=this.context.parameters.value.raw;if(this.fieldClicked){this.fieldClicked=false;value=!value}return;value:value};FieldSectionItem.prototype.destroy=function(){};return FieldSectionItem}();Containers.FieldSectionItem=FieldSectionItem})(Containers=MscrmGeneric.Containers||(MscrmGeneric.Containers={}))})(MscrmGeneric||(MscrmGeneric={}))